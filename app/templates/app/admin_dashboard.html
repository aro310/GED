{% extends 'app/base.html' %}
{% load static %}

{% block title %}Tableau de bord - Administrateur{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="{% static 'admin.css' %}">
{% endblock %}

{% block main_content %}

<div class="dashboard-container">
    <h1>Bienvenue, {{ user.username }} (Administrateur)</h1>
    <h2>Gestion des utilisateurs</h2>

    <a href="{% url 'register' %}" class="btn btn-success mb-3">Ajouter un utilisateur</a>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>Nom d'utilisateur</th>
                <th>Email</th>
                <th>RÃ´le</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.username }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.role }}</td>
                <td>
                    <a href="{% url 'edit_user' user.id %}" class="btn btn-warning btn-sm">Modifier</a>
                    <form method="POST" action="{% url 'delete_user' user.id %}" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm">Supprimer</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Fichiers dans Documents/</h2>

    <a href="?path=" class="btn btn-secondary mb-3"><i class="bi bi-house-fill"></i> Racine</a>

    {% if current_path %}
    <p>Dossier courant : <strong>{{ current_path }}</strong></p>
    {% endif %}

    <div class="file-list">
        <h4><i class="bi bi-folder-fill"></i> Dossiers</h4>
        {% for folder in folders %}
            <div class="file-entry">
                <div>
                    <i class="bi bi-folder-fill text-warning"></i>
                    <a href="?path={{ folder.path }}">{{ folder.name }}</a>
                </div>
                <form method="POST" action="{% url 'delete_entry' %}">
                    {% csrf_token %}
                    <input type="hidden" name="path" value="{{ folder.path }}">
                    <button class="btn btn-danger btn-sm">Supprimer</button>
                </form>
            </div>
        {% empty %}
            <p class="text-muted">Aucun dossier.</p>
        {% endfor %}
    </div>

    <div class="file-list">
        <h4><i class="bi bi-file-earmark-pdf-fill"></i> Fichiers</h4>
        {% for file in files %}
            <div class="file-entry">
                <div>
                    <i class="bi bi-file-earmark-fill text-primary"></i>
                    <a href="{{ MEDIA_URL }}documents/{{ file.path }}" target="_blank">{{ file.name }}</a>
                </div>
                <form method="POST" action="{% url 'delete_entry' %}">
                    {% csrf_token %}
                    <input type="hidden" name="path" value="{{ file.path }}">
                    <button class="btn btn-danger btn-sm">Supprimer</button>
                </form>
            </div>
        {% empty %}
            <p class="text-muted">Aucun fichier.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
